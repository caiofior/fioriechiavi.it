<?php
$taxa = new \flora\taxa\Taxa($GLOBALS['db']);
if (array_key_exists('id', $_REQUEST)) {
   $taxa->loadFromId($_REQUEST['id']);
} else {
   $taxa->setData($_REQUEST);
}
$regionColl = $taxa->getRegionColl();
?><link rel="stylesheet" href="//cdn.jsdelivr.net/plupload/2.1.1/jquery.ui.plupload/css/jquery.ui.plupload.css">
<!--
<link rel="stylesheet" href="js/plupload/js/jquery.ui.plupload/css/jquery.ui.plupload.css">
-->
<link rel="stylesheet" href="<?php echo $GLOBALS['db']->config->staticUrl.$GLOBALS['template']->getUrlModifyTimestamp('style/administrator/taxa.css');?>">
<div id="breadcrump">
   <p><a href="<?php echo $GLOBALS['db']->config->baseUrl;?>administrator.php">Home</a></p> &gt; <p><a href="<?php echo $GLOBALS['db']->config->baseUrl;?>administrator.php?task=taxa">Elenco dei taxa</a></p> &gt; <h2>Modifica un taxa</h2>
</div>
<form method="post" action="#" enctype="multipart/form-data">
   <input type="hidden" id="id" name="id" value="<?php echo $taxa->getData('id')?>">
   <input type="hidden" id="dico_id" name="dico_id" value="<?php echo $taxa->getData('dico_id')?>">
   <input type="hidden" id="taxa_kind_id" name="taxa_kind_id" value="<?php echo $taxa->getData('taxa_kind_id')?>">
   <?php if (array_key_exists('children_dico_id', $_REQUEST)): ?>
   <input type="hidden" id="children_dico_id" name="children_dico_id" value="<?php echo $_REQUEST['children_dico_id'];?>">
   <?php endif; ?>
   <?php if (array_key_exists('children_dico_item_id', $_REQUEST)): ?>
   <input type="hidden" id="children_dico_item_id" name="children_dico_item_id" value="<?php echo $_REQUEST['children_dico_item_id'];?>">
   <?php endif;
   if (is_numeric($taxa->getData('id')) && $taxa->getData('status') == true) : ?>
   <div>
      <div class="saved">
         <a class="blank" href="<?php echo $GLOBALS['db']->config->baseUrl;?>?id=<?php echo $taxa->getData('id')?>">Guarda pagina</a>
      </div>
      <div class="tosave" style="display: none;">
         <p>Salva la pagina per vederne l'anteprima</p>
      </div>
   <div>
   <?php endif; ?>
   <div>
      <input type="submit" name="submit" value="Salva">
      <?php if (!array_key_exists('children_dico_item_id', $_REQUEST)): ?>
      <input type="submit" name="submit_back" value="Salva e torna">
      <?php endif; ?>
      <a class="saved" href="<?php echo $GLOBALS['db']->config->baseUrl;?>administrator.php?task=dico&action=edit&id=<?php echo $taxa->getData('id')?>">Chiave dicotomica</a>
   </div>
   <div>
   <label for="taxa_kind_id_name">Categoria</label>
   <input id="taxa_kind_id_name" name="taxa_kind_id_name" value="<?php echo $taxa->getData('taxa_kind_id_name')?>">
   </div>
   <div>
   <label for="name">Nome</label>
   <input id="name" name="name" value="<?php echo $taxa->getData('name')?>">
   </div>
   <div>
    <label for="col_id">Catalog of life ID</label>
    <input id="col_id" name="col_id" value="<?php echo $taxa->getData('col_id')?>"><a class="update_col_id actions update" title="Aggiorna" href="#">Aggiorna</a>
    <img class="ajaxLoader" src="<?php echo $GLOBALS['db']->config->baseUrl;?>/style/general/images/ajax-loader.gif" style="display: none;">
    <div id="col_id_list" style="display:none;"></div>
   </div>
   <div>
    <label for="eol_id">Encyclopedia of life ID</label>
    <input id="eol_id" name="eol_id" value="<?php echo $taxa->getData('eol_id')?>"><a class="update_eol_id actions update" title="Aggiorna" href="#">Aggiorna</a>
    <img class="ajaxLoader" src="<?php echo $GLOBALS['db']->config->baseUrl;?>/style/general/images/ajax-loader.gif" style="display: none;">
    <div id="eol_id_list" style="display:none;"></div>
   </div>
   <div>
      <label for="description">Descrizione</label> <a class="loadMarkup" href="#">Carica Markup</a>
      <div style="display: none;" id="description_markup_container">
         <label for="description">Incolla il codice di markup</label><br/>
         <textarea cols="80" rows="20" class="notEditable" id="description_markup" name="description_markup"></textarea><br/>
         <a class="confirmLoad" href="#">Carica</a>
         <a class="cancelLoad" href="#">Annulla</a>
      </div>
      <textarea id="description" name="description"><?php echo $taxa->getData('description')?></textarea>
   </div>
   <div>
      <div>
         <label for="regions">Regioni</label> <a class="selectAllRegions" href="#">Seleziona/Deseleziona tutte</a>
      </div>
      <div>
         
   <select id="regions" name="regions[]" size="15" multiple="multiple">
      <?php
      $regionColl = $taxa->getRegionColl();
      foreach ($regionColl->getItems() as $region) : 
         $selected = '';
         if ($region->getRawData('selected')==1) {
            $selected = 'selected="delected"';   
         }
      ?>
      <option <?php echo $selected; ?> value="<?php echo $region->getData('id');?>"><?php echo $region->getData('name');?></option>
      <?php endforeach; ?>
   </select>
         </div>
   </div>
   <div>
      <p>Aggiungi attibuto:</p>
      <div class="attributeTable">
         <label for="attribute_name" >Attributo</label>
         <label for="attribute_value" >Valore</label>
      </div>
      <div class="attributeTable">
         <input id="attribute_name" name="attribute_name">
         <input id="attribute_value" name="attribute_value">
      </div>
      <p id="attribute_error" style="display: none;">Indicare nome dell'attibuto e valore</p>
      <p id="attribute_missing_name" style="display: none;">Indicare nome dell'attibuto per avere dei suggerimenti sui valori</p>
      <div id="attribute_template">
      <?php 
      $attribute =new \flora\taxa\TaxaAttribute($GLOBALS['db']);
         require __DIR__.'/attributeBlock.phtml'; 
      ?>
      </div>
      <div id="attribute_list">
      <?php 
      $attributeColl = $taxa->getTaxaAttributeColl(); 
      foreach ($attributeColl->getItems() as $attribute) {
         require __DIR__.'/attributeBlock.phtml'; 
      }
      ?>
      </div>
   </div>
   <div>
       <label>Aggiungi file</label>
       <input type="file" accept="image/*" name="traditional_image"/>
   </div>    
   <div>
      <div id="uploader">
         <p>Il tuo browser non ha Flash, Silverlight e non supporta HTML5.</p>
      </div>
   </div>
   <div id="image_template">
    <?php 
    $image =new \flora\taxa\TaxaImage($GLOBALS['db']);
       require __DIR__.'/imageBlock.phtml'; 
    ?>
    </div>
   <div id="image_list">
      <?php
      $imageColl = $taxa->getTaxaImageColl(); 
      foreach ($imageColl->getItems() as $image) {
      require __DIR__.'/imageBlock.phtml'; }
      ?>
      </div>
   <?php if (is_numeric($taxa->getData('id')) && $taxa->getData('status') == true ) : ?>
   <div>
      <div class="saved">
         <a class="blank" href="<?php echo $GLOBALS['db']->config->baseUrl;?>?id=<?php echo $taxa->getData('id')?>">Guarda pagina</a>
      </div>
      <div class="tosave" style="display: none;">
         <p>Salva la pagina per vederne l'anteprima</p>
      </div>
   <div>
   <?php endif; ?>
   <div>
      <input type="submit" name="submit" value="Salva">
      <?php if (!array_key_exists('children_dico_item_id', $_REQUEST)): ?>
      <input type="submit" name="submit_back" value="Salva e torna">
      <?php endif; ?>
      <a class="saved" href="<?php echo $GLOBALS['db']->config->baseUrl;?>administrator.php?task=dico&action=edit&id=<?php echo $taxa->getData('id')?>">Chiave dicotomica</a>
   </div>
</form>
